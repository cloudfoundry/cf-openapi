/v3/droplets:
  get:
    summary: List droplets
    description: Retrieve all droplets.
    operationId: listDroplets
    tags:
      - Droplets
    parameters:
      - $ref: '../components/parameters/Page.yaml'
      - $ref: '../components/parameters/PerPage.yaml'
      - $ref: '../components/parameters/OrderBy.yaml'
      - $ref: '../components/parameters/CreatedAts.yaml'
      - $ref: '../components/parameters/UpdatedAts.yaml'
      - $ref: '../components/parameters/LabelSelector.yaml'
      - name: guids
        in: query
        schema:
          type: array
          items:
            type: string
        description: >
          Comma-delimited list of droplet GUIDs to filter by
      - name: states
        in: query
        schema:
          type: array
          items:
            type: string
            enum:
              - AWAITING_UPLOAD
              - PROCESSING_UPLOAD
              - STAGED
              - COPYING
              - FAILED
              - EXPIRED
        description: >
          Comma-delimited list of droplet states to filter by
      - name: app_guids
        in: query
        schema:
          type: array
          items:
            type: string
        description: >
          Comma-delimited list of app GUIDs to filter by
      - name: space_guids
        in: query
        schema:
          type: array
          items:
            type: string
        description: >
          Comma-delimited list of space GUIDs to filter by
      - name: organization_guids
        in: query
        schema:
          type: array
          items:
            type: string
        description: >
          Comma-delimited list of organization GUIDs to filter by
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              $ref: '../components/schemas/DropletList.yaml'
      '401':
        $ref: '../components/responses/Unauthorized.yaml'
      '403':
        $ref: '../components/responses/Forbidden.yaml'
      '500':
        $ref: '../components/responses/500.yaml'
  post:
    summary: Create a droplet
    description: This endpoint is only for creating a droplet without a package. To create a droplet based on a package, see [Create a build](#create-a-build).
    operationId: createDroplet
    tags:
      - Droplets
    requestBody:
      $ref: '../components/requestBodies/DropletCreateRequestBody.yaml'
    responses:
      '201':
        description: Droplet created
        content:
          application/json:
            schema:
              $ref: '../components/schemas/Droplet.yaml'
        links:
          app:
            operationId: getApp
            parameters:
              guid: $response.body#/relationships/app/data/guid
            description: Retrieve the app for this droplet
      '400':
        $ref: '../components/responses/BadRequest.yaml'
/v3/droplets/{guid}:
  get:
    summary: Get a droplet
    description: Retrieve a droplet.
    operationId: getDroplet
    tags:
      - Droplets
    parameters:
      - $ref: '../components/parameters/Guid.yaml'
    responses:
      '200':
        description: Droplet retrieved
        content:
          application/json:
            schema:
              $ref: '../components/schemas/Droplet.yaml'
        links:
          app:
            operationId: getApp
            parameters:
              guid: $response.body#/relationships/app/data/guid
            description: Retrieve the app for this droplet
      '400':
        $ref: '../components/responses/BadRequest.yaml'
  patch:
    summary: Update a droplet
    description: Update a droplet.
    operationId: updateDroplet
    tags:
      - Droplets
    parameters:
      - $ref: '../components/parameters/Guid.yaml'
    requestBody:
      description: Droplet object that needs to be updated
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              metadata:
                $ref: '../components/schemas/Metadata.yaml'
              image:
                type: string
                description: Image reference where the built complete image was stored
            required:
              - image
            description: Request schema for updating a droplet
    responses:
      '200':
        $ref: '../components/responses/DropletGetResponse.yaml'
      '400':
        $ref: '../components/responses/BadRequest.yaml'
      '401':
        $ref: '../components/responses/Unauthorized.yaml'
      '403':
        $ref: '../components/responses/Forbidden.yaml'
      '404':
        $ref: '../components/responses/NotFound.yaml'
      '422':
        description: Unprocessable Entity
        content:
          application/json:
            schema:
              $ref: '../components/schemas/Error.yaml'
  delete:
    summary: Delete a droplet
    description: Delete a droplet.
    operationId: deleteDroplet
    tags:
      - Droplets
    parameters:
      - $ref: '../components/parameters/Guid.yaml'
    responses:
      '204':
        description: Successfully deleted droplet
      '401':
        $ref: '../components/responses/Unauthorized.yaml'
      '404':
        $ref: '../components/responses/NotFound.yaml'
/v3/droplets/{guid}/download:
  get:
    summary: Download droplet bits
    description: |-
      Download a gzip compressed tarball file containing a Cloud Foundry compatible droplet.
      When using a remote blobstore, such as AWS, the response is a redirect to the actual location of the bits. If the client is automatically following redirects, then the OAuth token that was used to communicate with Cloud Controller will be relayed on the new redirect request. Some blobstores may reject the request in that case. Clients may need to follow the redirect without including the OAuth token.
      Only droplets that are in the `STAGED` state and have lifecycle type `buildpack` can be downloaded.
    operationId: downloadDroplet
    tags:
      - Droplets
    parameters:
      - $ref: '../components/parameters/Guid.yaml'
    responses:
      '200':
        description: OK
        content:
          application/octet-stream:
            schema:
              type: string
              format: binary
          text/html:
            schema:
              type: string
      '302':
        description: Redirect to download location
      '401':
        $ref: '../components/responses/Unauthorized.yaml'
      '404':
        $ref: '../components/responses/NotFound.yaml'
/v3/droplets/{guid}/upload:
  post:
    summary: Upload droplet bits
    description: Upload a gzip compressed tarball file containing a Cloud Foundry compatible droplet. The file must be sent as part of a multi-part form.
    operationId: uploadDroplet
    tags:
      - Droplets
    parameters:
      - $ref: '../components/parameters/Guid.yaml'
    requestBody:
      description: The droplet file to be uploaded
      required: true
      content:
        multipart/form-data:
          schema:
            type: object
            properties:
              bits:
                type: string
                format: binary
              resources:
                type: array
                items:
                  type: object
                  properties:
                    path:
                      type: string
                    size_in_bytes:
                      type: integer
                    checksum:
                      type: object
                      properties:
                        value:
                          type: string
    responses:
      '200':
        $ref: '../components/responses/DropletGetResponse.yaml'
      '202':
        description: Upload initiated
        headers:
          Location:
            schema:
              type: string
            description: URL of the job tracking the upload
        content:
          application/json:
            schema:
              $ref: '../components/schemas/Droplet.yaml'
      '401':
        $ref: '../components/responses/Unauthorized.yaml'
      '404':
        $ref: '../components/responses/NotFound.yaml'
      '422':
        $ref: '../components/responses/UnprocessableEntity.yaml'

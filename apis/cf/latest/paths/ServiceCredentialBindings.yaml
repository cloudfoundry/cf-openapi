/v3/service_credential_bindings:
  get:
    summary: List service credential bindings
    description: This endpoint retrieves the service credential bindings the user has access to.
    operationId: listServiceCredentialBindings
    tags:
      - Service Credential Bindings
    parameters:
      - $ref: ../components/parameters/Page.yaml
      - $ref: ../components/parameters/PerPage.yaml
      - $ref: ../components/parameters/OrderBy.yaml
      - $ref: ../components/parameters/CreatedAts.yaml
      - $ref: ../components/parameters/UpdatedAts.yaml
      - $ref: ../components/parameters/LabelSelector.yaml
      - name: names
        in: query
        schema:
          type: array
          items:
            type: string
        description: Comma-delimited list of service credential binding names to filter by
      - name: service_instance_guids
        in: query
        schema:
          type: array
          items:
            type: string
        description: Comma-delimited list of service instance guids to filter by
      - name: app_guids
        in: query
        schema:
          type: array
          items:
            type: string
        description: Comma-delimited list of app guids to filter by
      - name: type
        in: query
        schema:
          type: string
          enum:
            - app
            - key
        description: Type of credential binding to filter by. Valid values are 'app' or 'key'
      - name: service_instance_names
        in: query
        schema:
          type: array
          items:
            type: string
        description: Comma-delimited list of service instance names to filter by
      - name: app_names
        in: query
        schema:
          type: array
          items:
            type: string
        description: Comma-delimited list of app names to filter by
      - name: service_plan_guids
        in: query
        schema:
          type: array
          items:
            type: string
        description: Comma-delimited list of service plan guids to filter by
      - name: service_plan_names
        in: query
        schema:
          type: array
          items:
            type: string
        description: Comma-delimited list of service plan names to filter by
      - name: service_offering_guids
        in: query
        schema:
          type: array
          items:
            type: string
        description: Comma-delimited list of service offering guids to filter by
      - name: service_offering_names
        in: query
        schema:
          type: array
          items:
            type: string
        description: Comma-delimited list of service offering names to filter by
      - name: guids
        in: query
        schema:
          type: array
          items:
            type: string
        description: Comma-delimited list of service credential binding guids to filter by
      - name: include
        in: query
        schema:
          type: array
          items:
            type: string
            enum:
              - app
              - service_instance
        description: "Optionally include a list of unique related resources in the response. Valid values are: `app`, `service_instance`"
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              $ref: ../components/schemas/ServiceCredentialBindingList.yaml
      '401':
        $ref: ../components/responses/Unauthorized.yaml
  post:
    summary: Create a service credential binding
    description: |-
      This endpoint creates a new service credential binding. Service credential bindings can be of type `app` or `key`; `key` is only valid for managed service instances.

      If failures occur when creating a service credential binding for a managed service instances, the API might execute orphan mitigation steps accordingly to cases outlined in the [OSBAPI specification](https://github.com/openservicebrokerapi/servicebroker/blob/master/spec.md#orphan-mitigation)
    operationId: createServiceCredentialBinding
    tags:
      - Service Credential Bindings
    requestBody:
      $ref: '../components/requestBodies/ServiceCredentialBindingCreateRequestBody.yaml'
    responses:
      '201':
        description: Created
        content:
          application/json:
            schema:
              oneOf:
                - $ref: ../components/schemas/AppCredentialBinding.yaml
                - $ref: ../components/schemas/KeyCredentialBinding.yaml
      '202':
        description: Accepted
        headers:
          Location:
            description: URL of the job that is creating the service credential binding
            schema:
              type: string
              format: uri
      '400':
        $ref: ../components/responses/BadRequest.yaml
      '401':
        $ref: ../components/responses/Unauthorized.yaml
      '403':
        $ref: ../components/responses/Forbidden.yaml
      '422':
        $ref: ../components/responses/UnprocessableEntity.yaml
/v3/service_credential_bindings/{guid}:
  get:
    summary: Get a service credential binding
    description: This endpoint retrieves the service credential binding by GUID.
    operationId: getServiceCredentialBinding
    tags:
      - Service Credential Bindings
    parameters:
      - $ref: ../components/parameters/Guid.yaml
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              oneOf:
                - $ref: ../components/schemas/AppCredentialBinding.yaml
                - $ref: ../components/schemas/KeyCredentialBinding.yaml
        links:
          app:
            operationId: getApp
            parameters:
              guid: $response.body#/relationships/app/data/guid
            description: Retrieve the app for this credential binding (app bindings only)
          service_instance:
            operationId: getServiceInstance
            parameters:
              guid: $response.body#/relationships/service_instance/data/guid
            description: Retrieve the service instance for this credential binding
      '401':
        $ref: '../components/responses/Unauthorized.yaml'
      '404':
        $ref: ../components/responses/NotFound.yaml
  patch:
    summary: Update a service credential binding
    description: This endpoint updates a service credential binding with labels and annotations.
    operationId: updateServiceCredentialBinding
    tags:
      - Service Credential Bindings
    parameters:
      - $ref: ../components/parameters/Guid.yaml
    requestBody:
      $ref: '../components/requestBodies/ServiceCredentialBindingUpdateRequestBody.yaml'
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              oneOf:
                - $ref: ../components/schemas/AppCredentialBinding.yaml
                - $ref: ../components/schemas/KeyCredentialBinding.yaml
      '401':
        $ref: '../components/responses/Unauthorized.yaml'
      '404':
        $ref: ../components/responses/NotFound.yaml
      '422':
        $ref: ../components/responses/UnprocessableEntity.yaml
  delete:
    summary: Delete a service credential binding
    description: "This endpoint deletes a service credential binding. When deleting credential bindings originated from user provided service instances, the delete operation does not require interactions with service brokers, therefore the API will respond synchronously to the delete request."
    operationId: deleteServiceCredentialBinding
    tags:
      - Service Credential Bindings
    parameters:
      - $ref: ../components/parameters/Guid.yaml
    responses:
      '202':
        description: Accepted
        headers:
          Location:
            description: URL of the job that is deleting the service credential binding
            schema:
              type: string
              format: uri
      '204':
        description: No Content
      '401':
        $ref: '../components/responses/Unauthorized.yaml'
      '404':
        $ref: ../components/responses/NotFound.yaml
/v3/service_credential_bindings/{guid}/details:
  get:
    summary: Get a service credential binding details
    description: This endpoint retrieves the service credential binding details.
    operationId: getServiceCredentialBindingDetails
    tags:
      - Service Credential Bindings
    parameters:
      - $ref: ../components/parameters/Guid.yaml
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              type: object
      '401':
        $ref: '../components/responses/Unauthorized.yaml'
      '404':
        $ref: ../components/responses/NotFound.yaml
/v3/service_credential_bindings/{guid}/parameters:
  get:
    summary: Get parameters for a service credential binding
    description: |-
      Queries the Service Broker for the parameters associated with this service credential binding. The broker catalog must have enabled the `bindings_retrievable` feature for the Service Offering. Check the [Service Offering object](#the-service-offering-object) for the value of this feature flag. This endpoint is not available for User-Provided Service Instances.
    operationId: getServiceCredentialBindingParameters
    tags:
      - Service Credential Bindings
    parameters:
      - $ref: ../components/parameters/Guid.yaml
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              type: object
      '401':
        $ref: '../components/responses/Unauthorized.yaml'
      '404':
        $ref: '../components/responses/NotFound.yaml'
